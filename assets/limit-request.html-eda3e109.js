import{_ as p}from"./plugin-vue_export-helper-c27b6911.js";import{r as o,o as c,c as i,a as n,b as s,d as e,e as t}from"./app-8a5cd404.js";const l={},u=n("p",null,"é’ˆå¯¹è½¯ä»¶ç³»ç»Ÿæ¥è¯´ï¼Œé™æµå°±æ˜¯å¯¹è¯·æ±‚çš„é€Ÿç‡è¿›è¡Œé™åˆ¶ï¼Œé¿å…ç¬æ—¶çš„å¤§é‡è¯·æ±‚å‡»å®è½¯ä»¶ç³»ç»Ÿã€‚æ¯•ç«Ÿï¼Œè½¯ä»¶ç³»ç»Ÿçš„å¤„ç†èƒ½åŠ›æ˜¯æœ‰é™çš„ã€‚å¦‚æœè¯´è¶…è¿‡äº†å…¶å¤„ç†èƒ½åŠ›çš„èŒƒå›´ï¼Œè½¯ä»¶ç³»ç»Ÿå¯èƒ½ç›´æ¥å°±æŒ‚æ‰äº†ã€‚",-1),r=n("p",null,"é™æµå¯èƒ½ä¼šå¯¼è‡´ç”¨æˆ·çš„è¯·æ±‚æ— æ³•è¢«æ­£ç¡®å¤„ç†ï¼Œä¸è¿‡ï¼Œè¿™å¾€å¾€ä¹Ÿæ˜¯æƒè¡¡äº†è½¯ä»¶ç³»ç»Ÿçš„ç¨³å®šæ€§ä¹‹åå¾—åˆ°çš„æœ€ä¼˜è§£ã€‚",-1),d=n("p",null,"ç°å®ç”Ÿæ´»ä¸­ï¼Œå¤„å¤„éƒ½æœ‰é™æµçš„å®é™…åº”ç”¨ï¼Œå°±æ¯”å¦‚æ’é˜Ÿä¹°ç¥¨æ˜¯ä¸ºäº†é¿å…å¤§é‡ç”¨æˆ·æ¶Œå…¥è´­ç¥¨è€Œå¯¼è‡´å”®ç¥¨å‘˜æ— æ³•å¤„ç†ã€‚",-1),k=n("h2",{id:"å¸¸è§é™æµç®—æ³•æœ‰å“ªäº›",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#å¸¸è§é™æµç®—æ³•æœ‰å“ªäº›","aria-hidden":"true"},"#"),s(" å¸¸è§é™æµç®—æ³•æœ‰å“ªäº›ï¼Ÿ")],-1),m=n("p",null,"ç®€å•ä»‹ç» 4 ç§éå¸¸å¥½ç†è§£å¹¶ä¸”å®¹æ˜“å®ç°çš„é™æµç®—æ³•ï¼",-1),v={href:"https://www.infoq.cn/article/Qg2tX8fyw5Vt-f3HH673",target:"_blank",rel:"noopener noreferrer"},g=t('<h3 id="å›ºå®šçª—å£è®¡æ•°å™¨ç®—æ³•" tabindex="-1"><a class="header-anchor" href="#å›ºå®šçª—å£è®¡æ•°å™¨ç®—æ³•" aria-hidden="true">#</a> å›ºå®šçª—å£è®¡æ•°å™¨ç®—æ³•</h3><p>å›ºå®šçª—å£å…¶å®å°±æ˜¯æ—¶é—´çª—å£ã€‚<strong>å›ºå®šçª—å£è®¡æ•°å™¨ç®—æ³•</strong> è§„å®šäº†æˆ‘ä»¬å•ä½æ—¶é—´å¤„ç†çš„è¯·æ±‚æ•°é‡ã€‚</p><p>å‡å¦‚æˆ‘ä»¬è§„å®šç³»ç»Ÿä¸­æŸä¸ªæ¥å£ 1 åˆ†é’Ÿåªèƒ½è®¿é—® 33 æ¬¡çš„è¯ï¼Œä½¿ç”¨å›ºå®šçª—å£è®¡æ•°å™¨ç®—æ³•çš„å®ç°æ€è·¯å¦‚ä¸‹ï¼š</p><ul><li>ç»™å®šä¸€ä¸ªå˜é‡ <code>counter</code> æ¥è®°å½•å½“å‰æ¥å£å¤„ç†çš„è¯·æ±‚æ•°é‡ï¼Œåˆå§‹å€¼ä¸º 0ï¼ˆä»£è¡¨æ¥å£å½“å‰ 1 åˆ†é’Ÿå†…è¿˜æœªå¤„ç†è¯·æ±‚ï¼‰ã€‚</li><li>1 åˆ†é’Ÿä¹‹å†…æ¯å¤„ç†ä¸€ä¸ªè¯·æ±‚ä¹‹åå°±å°† <code>counter+1</code> ï¼Œå½“ <code>counter=33</code> ä¹‹åï¼ˆä¹Ÿå°±æ˜¯è¯´åœ¨è¿™ 1 åˆ†é’Ÿå†…æ¥å£å·²ç»è¢«è®¿é—® 33 æ¬¡çš„è¯ï¼‰ï¼Œåç»­çš„è¯·æ±‚å°±ä¼šè¢«å…¨éƒ¨æ‹’ç»ã€‚</li><li>ç­‰åˆ° 1 åˆ†é’Ÿç»“æŸåï¼Œå°† <code>counter</code> é‡ç½® 0ï¼Œé‡æ–°å¼€å§‹è®¡æ•°ã€‚</li></ul><p><strong>è¿™ç§é™æµç®—æ³•æ— æ³•ä¿è¯é™æµé€Ÿç‡ï¼Œå› è€Œæ— æ³•ä¿è¯çªç„¶æ¿€å¢çš„æµé‡ã€‚</strong></p><p>å°±æ¯”å¦‚è¯´æˆ‘ä»¬é™åˆ¶æŸä¸ªæ¥å£ 1 åˆ†é’Ÿåªèƒ½è®¿é—® 1000 æ¬¡ï¼Œè¯¥æ¥å£çš„ QPS ä¸º 500ï¼Œå‰ 55s è¿™ä¸ªæ¥å£ 1 ä¸ªè¯·æ±‚æ²¡æœ‰æ¥æ”¶ï¼Œå 1s çªç„¶æ¥æ”¶äº† 1000 ä¸ªè¯·æ±‚ã€‚ç„¶åï¼Œåœ¨å½“å‰åœºæ™¯ä¸‹ï¼Œè¿™ 1000 ä¸ªè¯·æ±‚åœ¨ 1s å†…æ˜¯æ²¡åŠæ³•è¢«å¤„ç†çš„ï¼Œç³»ç»Ÿç›´æ¥å°±è¢«ç¬æ—¶çš„å¤§é‡è¯·æ±‚ç»™å‡»å®äº†ã€‚</p><figure><img src="https://static001.infoq.cn/resource/image/8d/15/8ded7a2b90e1482093f92fff555b3615.png" alt="å›ºå®šçª—å£è®¡æ•°å™¨ç®—æ³•" tabindex="0" loading="lazy"><figcaption>å›ºå®šçª—å£è®¡æ•°å™¨ç®—æ³•</figcaption></figure><h3 id="æ»‘åŠ¨çª—å£è®¡æ•°å™¨ç®—æ³•" tabindex="-1"><a class="header-anchor" href="#æ»‘åŠ¨çª—å£è®¡æ•°å™¨ç®—æ³•" aria-hidden="true">#</a> æ»‘åŠ¨çª—å£è®¡æ•°å™¨ç®—æ³•</h3><p><strong>æ»‘åŠ¨çª—å£è®¡æ•°å™¨ç®—æ³•</strong> ç®—çš„ä¸Šæ˜¯å›ºå®šçª—å£è®¡æ•°å™¨ç®—æ³•çš„å‡çº§ç‰ˆã€‚</p><p>æ»‘åŠ¨çª—å£è®¡æ•°å™¨ç®—æ³•ç›¸æ¯”äºå›ºå®šçª—å£è®¡æ•°å™¨ç®—æ³•çš„ä¼˜åŒ–åœ¨äºï¼š<strong>å®ƒæŠŠæ—¶é—´ä»¥ä¸€å®šæ¯”ä¾‹åˆ†ç‰‡</strong> ã€‚</p><p>ä¾‹å¦‚æˆ‘ä»¬çš„æ¥å£é™æµæ¯åˆ†é’Ÿå¤„ç† 60 ä¸ªè¯·æ±‚ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠ 1 åˆ†é’Ÿåˆ†ä¸º 60 ä¸ªçª—å£ã€‚æ¯éš” 1 ç§’ç§»åŠ¨ä¸€æ¬¡ï¼Œæ¯ä¸ªçª—å£ä¸€ç§’åªèƒ½å¤„ç† ä¸å¤§äº <code>60(è¯·æ±‚æ•°)/60ï¼ˆçª—å£æ•°ï¼‰</code> çš„è¯·æ±‚ï¼Œ å¦‚æœå½“å‰çª—å£çš„è¯·æ±‚è®¡æ•°æ€»å’Œè¶…è¿‡äº†é™åˆ¶çš„æ•°é‡çš„è¯å°±ä¸å†å¤„ç†å…¶ä»–è¯·æ±‚ã€‚</p><p>å¾ˆæ˜¾ç„¶ï¼Œ <strong>å½“æ»‘åŠ¨çª—å£çš„æ ¼å­åˆ’åˆ†çš„è¶Šå¤šï¼Œæ»‘åŠ¨çª—å£çš„æ»šåŠ¨å°±è¶Šå¹³æ»‘ï¼Œé™æµçš„ç»Ÿè®¡å°±ä¼šè¶Šç²¾ç¡®ã€‚</strong></p><figure><img src="https://static001.infoq.cn/resource/image/ae/15/ae4d3cd14efb8dc7046d691c90264715.png" alt="æ»‘åŠ¨çª—å£è®¡æ•°å™¨ç®—æ³•" tabindex="0" loading="lazy"><figcaption>æ»‘åŠ¨çª—å£è®¡æ•°å™¨ç®—æ³•</figcaption></figure><h3 id="æ¼æ¡¶ç®—æ³•" tabindex="-1"><a class="header-anchor" href="#æ¼æ¡¶ç®—æ³•" aria-hidden="true">#</a> æ¼æ¡¶ç®—æ³•</h3><p>æˆ‘ä»¬å¯ä»¥æŠŠå‘è¯·æ±‚çš„åŠ¨ä½œæ¯”ä½œæˆæ³¨æ°´åˆ°æ¡¶ä¸­ï¼Œæˆ‘ä»¬å¤„ç†è¯·æ±‚çš„è¿‡ç¨‹å¯ä»¥æ¯”å–»ä¸ºæ¼æ¡¶æ¼æ°´ã€‚æˆ‘ä»¬å¾€æ¡¶ä¸­ä»¥ä»»æ„é€Ÿç‡æµå…¥æ°´ï¼Œä»¥ä¸€å®šé€Ÿç‡æµå‡ºæ°´ã€‚å½“æ°´è¶…è¿‡æ¡¶æµé‡åˆ™ä¸¢å¼ƒï¼Œå› ä¸ºæ¡¶å®¹é‡æ˜¯ä¸å˜çš„ï¼Œä¿è¯äº†æ•´ä½“çš„é€Ÿç‡ã€‚</p><p>å¦‚æœæƒ³è¦å®ç°è¿™ä¸ªç®—æ³•çš„è¯ä¹Ÿå¾ˆç®€å•ï¼Œå‡†å¤‡ä¸€ä¸ªé˜Ÿåˆ—ç”¨æ¥ä¿å­˜è¯·æ±‚ï¼Œç„¶åæˆ‘ä»¬å®šæœŸä»é˜Ÿåˆ—ä¸­æ‹¿è¯·æ±‚æ¥æ‰§è¡Œå°±å¥½äº†ï¼ˆå’Œæ¶ˆæ¯é˜Ÿåˆ—å‰Šå³°/é™æµçš„æ€æƒ³æ˜¯ä¸€æ ·çš„ï¼‰ã€‚</p><figure><img src="https://static001.infoq.cn/resource/image/75/03/75938d1010138ce66e38c6ed0392f103.png" alt="æ¼æ¡¶ç®—æ³•" tabindex="0" loading="lazy"><figcaption>æ¼æ¡¶ç®—æ³•</figcaption></figure><h3 id="ä»¤ç‰Œæ¡¶ç®—æ³•" tabindex="-1"><a class="header-anchor" href="#ä»¤ç‰Œæ¡¶ç®—æ³•" aria-hidden="true">#</a> ä»¤ç‰Œæ¡¶ç®—æ³•</h3><p>ä»¤ç‰Œæ¡¶ç®—æ³•ä¹Ÿæ¯”è¾ƒç®€å•ã€‚å’Œæ¼æ¡¶ç®—æ³•ç®—æ³•ä¸€æ ·ï¼Œæˆ‘ä»¬çš„ä¸»è§’è¿˜æ˜¯æ¡¶ï¼ˆè¿™é™æµç®—æ³•å’Œæ¡¶è¿‡ä¸å»å•Šï¼‰ã€‚ä¸è¿‡ç°åœ¨æ¡¶é‡Œè£…çš„æ˜¯ä»¤ç‰Œäº†ï¼Œè¯·æ±‚åœ¨è¢«å¤„ç†ä¹‹å‰éœ€è¦æ‹¿åˆ°ä¸€ä¸ªä»¤ç‰Œï¼Œè¯·æ±‚å¤„ç†å®Œæ¯•ä¹‹åå°†è¿™ä¸ªä»¤ç‰Œä¸¢å¼ƒï¼ˆåˆ é™¤ï¼‰ã€‚æˆ‘ä»¬æ ¹æ®é™æµå¤§å°ï¼ŒæŒ‰ç…§ä¸€å®šçš„é€Ÿç‡å¾€æ¡¶é‡Œæ·»åŠ ä»¤ç‰Œã€‚å¦‚æœæ¡¶è£…æ»¡äº†ï¼Œå°±ä¸èƒ½ç»§ç»­å¾€é‡Œé¢ç»§ç»­æ·»åŠ ä»¤ç‰Œäº†ã€‚</p><figure><img src="https://static001.infoq.cn/resource/image/ec/93/eca0e5eaa35dac938c673fecf2ec9a93.png" alt="ä»¤ç‰Œæ¡¶ç®—æ³•" tabindex="0" loading="lazy"><figcaption>ä»¤ç‰Œæ¡¶ç®—æ³•</figcaption></figure><h2 id="å•æœºé™æµæ€ä¹ˆåš" tabindex="-1"><a class="header-anchor" href="#å•æœºé™æµæ€ä¹ˆåš" aria-hidden="true">#</a> å•æœºé™æµæ€ä¹ˆåšï¼Ÿ</h2><p>å•æœºé™æµé’ˆå¯¹çš„æ˜¯å•ä½“æ¶æ„åº”ç”¨ã€‚</p><p>å•æœºé™æµå¯ä»¥ç›´æ¥ä½¿ç”¨ Google Guava è‡ªå¸¦çš„é™æµå·¥å…·ç±» <code>RateLimiter</code> ã€‚ <code>RateLimiter</code> åŸºäºä»¤ç‰Œæ¡¶ç®—æ³•ï¼Œå¯ä»¥åº”å¯¹çªå‘æµé‡ã€‚</p>',23),b={href:"https://github.com/google/guava",target:"_blank",rel:"noopener noreferrer"},h=t(`<p>é™¤äº†æœ€åŸºæœ¬çš„ä»¤ç‰Œæ¡¶ç®—æ³•(å¹³æ»‘çªå‘é™æµ)å®ç°ä¹‹å¤–ï¼ŒGuava çš„<code>RateLimiter</code>è¿˜æä¾›äº† <strong>å¹³æ»‘é¢„çƒ­é™æµ</strong> çš„ç®—æ³•å®ç°ã€‚</p><p>å¹³æ»‘çªå‘é™æµå°±æ˜¯æŒ‰ç…§æŒ‡å®šçš„é€Ÿç‡æ”¾ä»¤ç‰Œåˆ°æ¡¶é‡Œï¼Œè€Œå¹³æ»‘é¢„çƒ­é™æµä¼šæœ‰ä¸€æ®µé¢„çƒ­æ—¶é—´ï¼Œé¢„çƒ­æ—¶é—´ä¹‹å†…ï¼Œé€Ÿç‡ä¼šé€æ¸æå‡åˆ°é…ç½®çš„é€Ÿç‡ã€‚</p><p>æˆ‘ä»¬ä¸‹é¢é€šè¿‡ä¸¤ä¸ªç®€å•çš„å°ä¾‹å­æ¥è¯¦ç»†äº†è§£å§ï¼</p><p>æˆ‘ä»¬ç›´æ¥åœ¨é¡¹ç›®ä¸­å¼•å…¥ Guava ç›¸å…³çš„ä¾èµ–å³å¯ä½¿ç”¨ã€‚</p><div class="language-xml line-numbers-mode" data-ext="xml"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.google.guava<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>guava<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>31.0.1-jre<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä¸‹é¢æ˜¯ä¸€ä¸ªç®€å•çš„ Guava å¹³æ»‘çªå‘é™æµçš„ Demoã€‚</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>google<span class="token punctuation">.</span>common<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token class-name">RateLimiter</span></span><span class="token punctuation">;</span>

<span class="token doc-comment comment">/**
 * å¾®ä¿¡æœ JavaGuide å›å¤&quot;é¢è¯•çªå‡»&quot;å³å¯å…è´¹é¢†å–ä¸ªäººåŸåˆ›çš„ Java é¢è¯•æ‰‹å†Œ
 *
 * <span class="token keyword">@author</span> Guideå“¥
 * <span class="token keyword">@date</span> 2021/10/08 19:12
 **/</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">RateLimiterDemo</span> <span class="token punctuation">{</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 1s æ”¾ 5 ä¸ªä»¤ç‰Œåˆ°æ¡¶é‡Œä¹Ÿå°±æ˜¯ 0.2s æ”¾ 1ä¸ªä»¤ç‰Œåˆ°æ¡¶é‡Œ</span>
        <span class="token class-name">RateLimiter</span> rateLimiter <span class="token operator">=</span> <span class="token class-name">RateLimiter</span><span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">10</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">double</span> sleepingTime <span class="token operator">=</span> rateLimiter<span class="token punctuation">.</span><span class="token function">acquire</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;get 1 tokens: %ss%n&quot;</span><span class="token punctuation">,</span> sleepingTime<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¾“å‡ºï¼š</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>get <span class="token number">1</span> tokens: <span class="token number">0</span>.0s
get <span class="token number">1</span> tokens: <span class="token number">0</span>.188413s
get <span class="token number">1</span> tokens: <span class="token number">0</span>.197811s
get <span class="token number">1</span> tokens: <span class="token number">0</span>.198316s
get <span class="token number">1</span> tokens: <span class="token number">0</span>.19864s
get <span class="token number">1</span> tokens: <span class="token number">0</span>.199363s
get <span class="token number">1</span> tokens: <span class="token number">0</span>.193997s
get <span class="token number">1</span> tokens: <span class="token number">0</span>.199623s
get <span class="token number">1</span> tokens: <span class="token number">0</span>.199357s
get <span class="token number">1</span> tokens: <span class="token number">0</span>.195676s
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä¸‹é¢æ˜¯ä¸€ä¸ªç®€å•çš„ Guava å¹³æ»‘é¢„çƒ­é™æµçš„ Demoã€‚</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>google<span class="token punctuation">.</span>common<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token class-name">RateLimiter</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token class-name">TimeUnit</span></span><span class="token punctuation">;</span>

<span class="token doc-comment comment">/**
 * å¾®ä¿¡æœ JavaGuide å›å¤&quot;é¢è¯•çªå‡»&quot;å³å¯å…è´¹é¢†å–ä¸ªäººåŸåˆ›çš„ Java é¢è¯•æ‰‹å†Œ
 *
 * <span class="token keyword">@author</span> Guideå“¥
 * <span class="token keyword">@date</span> 2021/10/08 19:12
 **/</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">RateLimiterDemo</span> <span class="token punctuation">{</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 1s æ”¾ 5 ä¸ªä»¤ç‰Œåˆ°æ¡¶é‡Œä¹Ÿå°±æ˜¯ 0.2s æ”¾ 1ä¸ªä»¤ç‰Œåˆ°æ¡¶é‡Œ</span>
        <span class="token comment">// é¢„çƒ­æ—¶é—´ä¸º3s,ä¹Ÿå°±è¯´åˆšå¼€å§‹çš„ 3s å†…å‘ç‰Œé€Ÿç‡ä¼šé€æ¸æå‡åˆ° 0.2s æ”¾ 1 ä¸ªä»¤ç‰Œåˆ°æ¡¶é‡Œ</span>
        <span class="token class-name">RateLimiter</span> rateLimiter <span class="token operator">=</span> <span class="token class-name">RateLimiter</span><span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span><span class="token constant">SECONDS</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">20</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">double</span> sleepingTime <span class="token operator">=</span> rateLimiter<span class="token punctuation">.</span><span class="token function">acquire</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;get 1 tokens: %sds%n&quot;</span><span class="token punctuation">,</span> sleepingTime<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¾“å‡ºï¼š</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>get <span class="token number">1</span> tokens: <span class="token number">0</span>.0s
get <span class="token number">1</span> tokens: <span class="token number">0</span>.561919s
get <span class="token number">1</span> tokens: <span class="token number">0</span>.516931s
get <span class="token number">1</span> tokens: <span class="token number">0</span>.463798s
get <span class="token number">1</span> tokens: <span class="token number">0</span>.41286s
get <span class="token number">1</span> tokens: <span class="token number">0</span>.356172s
get <span class="token number">1</span> tokens: <span class="token number">0</span>.300489s
get <span class="token number">1</span> tokens: <span class="token number">0</span>.252545s
get <span class="token number">1</span> tokens: <span class="token number">0</span>.203996s
get <span class="token number">1</span> tokens: <span class="token number">0</span>.198359s
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å¦å¤–ï¼Œ<strong>Bucket4j</strong> æ˜¯ä¸€ä¸ªéå¸¸ä¸é”™çš„åŸºäºä»¤ç‰Œ/æ¼æ¡¶ç®—æ³•çš„é™æµåº“ã€‚</p>`,14),f={href:"https://github.com/vladimir-bukhtoyarov/bucket4j",target:"_blank",rel:"noopener noreferrer"},_=n("p",null,"ç›¸å¯¹äºï¼ŒGuava çš„é™æµå·¥å…·ç±»æ¥è¯´ï¼ŒBucket4j æä¾›çš„é™æµåŠŸèƒ½æ›´åŠ å…¨é¢ã€‚ä¸ä»…æ”¯æŒå•æœºé™æµå’Œåˆ†å¸ƒå¼é™æµï¼Œè¿˜å¯ä»¥é›†æˆç›‘æ§ï¼Œæ­é… Prometheus å’Œ Grafana ä½¿ç”¨ã€‚",-1),y=n("p",null,"ä¸è¿‡ï¼Œæ¯•ç«Ÿ Guava ä¹Ÿåªæ˜¯ä¸€ä¸ªåŠŸèƒ½å…¨é¢çš„å·¥å…·ç±»åº“ï¼Œå…¶æä¾›çš„å¼€ç®±å³ç”¨çš„é™æµåŠŸèƒ½åœ¨å¾ˆå¤šå•æœºåœºæ™¯ä¸‹è¿˜æ˜¯æ¯”è¾ƒå®ç”¨çš„ã€‚",-1),w=n("p",null,[s("Spring Cloud Gateway ä¸­è‡ªå¸¦çš„å•æœºé™æµçš„æ—©æœŸç‰ˆæœ¬å°±æ˜¯åŸºäº Bucket4j å®ç°çš„ã€‚åæ¥ï¼Œæ›¿æ¢æˆäº† "),n("strong",null,"Resilience4j"),s("ã€‚")],-1),x={href:"https://github.com/Netflix/Hystrix/commit/a7df971cbaddd8c5e976b3cc5f14013fe6ad00e6",target:"_blank",rel:"noopener noreferrer"},R={href:"https://github.com/resilience4j/resilience4j",target:"_blank",rel:"noopener noreferrer"},j=t('<p>ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œä¸ºäº†ä¿è¯ç³»ç»Ÿçš„é«˜å¯ç”¨ï¼Œé¡¹ç›®çš„é™æµå’Œç†”æ–­éƒ½æ˜¯è¦ä¸€èµ·åšçš„ã€‚</p><p>Resilience4j ä¸ä»…æä¾›é™æµï¼Œè¿˜æä¾›äº†ç†”æ–­ã€è´Ÿè½½ä¿æŠ¤ã€è‡ªåŠ¨é‡è¯•ç­‰ä¿éšœç³»ç»Ÿé«˜å¯ç”¨å¼€ç®±å³ç”¨çš„åŠŸèƒ½ã€‚å¹¶ä¸”ï¼ŒResilience4j çš„ç”Ÿæ€ä¹Ÿæ›´å¥½ï¼Œå¾ˆå¤šç½‘å…³éƒ½ä½¿ç”¨ Resilience4j æ¥åšé™æµç†”æ–­çš„ã€‚</p><p>å› æ­¤ï¼Œåœ¨ç»å¤§éƒ¨åˆ†åœºæ™¯ä¸‹ Resilience4j æˆ–è®¸ä¼šæ˜¯æ›´å¥½çš„é€‰æ‹©ã€‚å¦‚æœæ˜¯ä¸€äº›æ¯”è¾ƒç®€å•çš„é™æµåœºæ™¯çš„è¯ï¼ŒGuava æˆ–è€… Bucket4j ä¹Ÿæ˜¯ä¸é”™çš„é€‰æ‹©ã€‚</p><h2 id="åˆ†å¸ƒå¼é™æµæ€ä¹ˆåš" tabindex="-1"><a class="header-anchor" href="#åˆ†å¸ƒå¼é™æµæ€ä¹ˆåš" aria-hidden="true">#</a> åˆ†å¸ƒå¼é™æµæ€ä¹ˆåšï¼Ÿ</h2><p>åˆ†å¸ƒå¼é™æµé’ˆå¯¹çš„åˆ†å¸ƒå¼/å¾®æœåŠ¡åº”ç”¨æ¶æ„åº”ç”¨ï¼Œåœ¨è¿™ç§æ¶æ„ä¸‹ï¼Œå•æœºé™æµå°±ä¸é€‚ç”¨äº†ï¼Œå› ä¸ºä¼šå­˜åœ¨å¤šç§æœåŠ¡ï¼Œå¹¶ä¸”ä¸€ç§æœåŠ¡ä¹Ÿå¯èƒ½ä¼šè¢«éƒ¨ç½²å¤šä»½ã€‚</p><p>åˆ†å¸ƒå¼é™æµå¸¸è§çš„æ–¹æ¡ˆï¼š</p><ul><li><strong>å€ŸåŠ©ä¸­é—´ä»¶æ¶é™æµ</strong>ï¼šå¯ä»¥å€ŸåŠ© Sentinel æˆ–è€…ä½¿ç”¨ Redis æ¥è‡ªå·±å®ç°å¯¹åº”çš„é™æµé€»è¾‘ã€‚</li><li><strong>ç½‘å…³å±‚é™æµ</strong>ï¼šæ¯”è¾ƒå¸¸ç”¨çš„ä¸€ç§æ–¹æ¡ˆï¼Œç›´æ¥åœ¨ç½‘å…³å±‚æŠŠé™æµç»™å®‰æ’ä¸Šäº†ã€‚ä¸è¿‡ï¼Œé€šå¸¸ç½‘å…³å±‚é™æµé€šå¸¸ä¹Ÿéœ€è¦å€ŸåŠ©åˆ°ä¸­é—´ä»¶/æ¡†æ¶ã€‚å°±æ¯”å¦‚ Spring Cloud Gateway çš„åˆ†å¸ƒå¼é™æµå®ç°<code>RedisRateLimiter</code>å°±æ˜¯åŸºäº Redis+Lua æ¥å®ç°çš„ï¼Œå†æ¯”å¦‚ Spring Cloud Gateway è¿˜å¯ä»¥æ•´åˆ Sentinel æ¥åšé™æµã€‚</li></ul><p>å¦‚æœä½ è¦åŸºäº Redis æ¥æ‰‹åŠ¨å®ç°é™æµé€»è¾‘çš„è¯ï¼Œå»ºè®®é…åˆ Lua è„šæœ¬æ¥åšã€‚</p><p><strong>ä¸ºä»€ä¹ˆå»ºè®® Redis+Lua çš„æ–¹å¼ï¼Ÿ</strong> ä¸»è¦æœ‰ä¸¤ç‚¹åŸå› ï¼š</p><ul><li><strong>å‡å°‘äº†ç½‘ç»œå¼€é”€</strong>ï¼šæˆ‘ä»¬å¯ä»¥åˆ©ç”¨ Lua è„šæœ¬æ¥æ‰¹é‡æ‰§è¡Œå¤šæ¡ Redis å‘½ä»¤ï¼Œè¿™äº› Redis å‘½ä»¤ä¼šè¢«æäº¤åˆ° Redis æœåŠ¡å™¨ä¸€æ¬¡æ€§æ‰§è¡Œå®Œæˆï¼Œå¤§å¹…å‡å°äº†ç½‘ç»œå¼€é”€ã€‚</li><li><strong>åŸå­æ€§</strong>ï¼šä¸€æ®µ Lua è„šæœ¬å¯ä»¥è§†ä½œä¸€æ¡å‘½ä»¤æ‰§è¡Œï¼Œä¸€æ®µ Lua è„šæœ¬æ‰§è¡Œè¿‡ç¨‹ä¸­ä¸ä¼šæœ‰å…¶ä»–è„šæœ¬æˆ– Redis å‘½ä»¤åŒæ—¶æ‰§è¡Œï¼Œä¿è¯äº†æ“ä½œä¸ä¼šè¢«å…¶ä»–æŒ‡ä»¤æ’å…¥æˆ–æ‰“æ‰°ã€‚</li></ul><p>æˆ‘è¿™é‡Œå°±ä¸æ”¾å…·ä½“çš„é™æµè„šæœ¬ä»£ç äº†ï¼Œç½‘ä¸Šä¹Ÿæœ‰å¾ˆå¤šç°æˆçš„ä¼˜ç§€çš„é™æµè„šæœ¬ä¾›ä½ å‚è€ƒï¼Œå°±æ¯”å¦‚ Apache ç½‘å…³é¡¹ç›® ShenYu çš„ RateLimiter é™æµæ’ä»¶å°±åŸºäº Redis + Lua å®ç°äº†ä»¤ç‰Œæ¡¶ç®—æ³•/å¹¶å‘ä»¤ç‰Œæ¡¶ç®—æ³•ã€æ¼æ¡¶ç®—æ³•ã€æ»‘åŠ¨çª—å£ç®—æ³•ã€‚</p>',11),L={href:"https://github.com/apache/incubator-shenyu",target:"_blank",rel:"noopener noreferrer"},q=n("figure",null,[n("img",{src:"https://oss.javaguide.cn/github/javaguide/csdn/e1e2a75f489e4854990dabe3b6cec522.jpg",alt:"ShenYu é™æµè„šæœ¬",tabindex:"0",loading:"lazy"}),n("figcaption",null,"ShenYu é™æµè„šæœ¬")],-1),G=n("h2",{id:"ç›¸å…³é˜…è¯»",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#ç›¸å…³é˜…è¯»","aria-hidden":"true"},"#"),s(" ç›¸å…³é˜…è¯»")],-1),S={href:"https://xie.infoq.cn/article/14786e571c1a4143ad1ef8f19",target:"_blank",rel:"noopener noreferrer"},B={href:"https://cloud.tencent.com/developer/article/1408819",target:"_blank",rel:"noopener noreferrer"},N={href:"https://www.aneasystone.com/archives/2020/08/spring-cloud-gateway-current-limiting.html",target:"_blank",rel:"noopener noreferrer"};function I(T,C){const a=o("ExternalLinkIcon");return c(),i("div",null,[u,r,d,k,m,n("blockquote",null,[n("p",null,[s("å›¾ç‰‡æ¥æºäº InfoQ çš„ä¸€ç¯‡æ–‡ç« "),n("a",v,[s("ã€Šåˆ†å¸ƒå¼æœåŠ¡é™æµå®æˆ˜ï¼Œå·²ç»ä¸ºä½ æ’å¥½å‘äº†ã€‹"),e(a)]),s("ã€‚")])]),g,n("blockquote",null,[n("p",null,[s("Guava åœ°å€ï¼š"),n("a",b,[s("https://github.com/google/guava"),e(a)])])]),h,n("blockquote",null,[n("p",null,[s("Bucket4j åœ°å€ï¼š"),n("a",f,[s("https://github.com/vladimir-bukhtoyarov/bucket4j"),e(a)])])]),_,y,w,n("p",null,[s("Resilience4j æ˜¯ä¸€ä¸ªè½»é‡çº§çš„å®¹é”™ç»„ä»¶ï¼Œå…¶çµæ„Ÿæ¥è‡ªäº Hystrixã€‚è‡ª"),n("a",x,[s("Netflix å®£å¸ƒä¸å†ç§¯æå¼€å‘ Hystrix"),e(a)]),s(" ä¹‹åï¼ŒSpring å®˜æ–¹å’Œ Netflix éƒ½æ›´æ¨èä½¿ç”¨ Resilience4j æ¥åšé™æµç†”æ–­ã€‚")]),n("blockquote",null,[n("p",null,[s("Resilience4j åœ°å€: "),n("a",R,[s("https://github.com/resilience4j/resilience4j"),e(a)])])]),j,n("blockquote",null,[n("p",null,[s("ShenYu åœ°å€: "),n("a",L,[s("https://github.com/apache/incubator-shenyu"),e(a)])])]),q,G,n("ul",null,[n("li",null,[s("æœåŠ¡æ²»ç†ä¹‹è½»é‡çº§ç†”æ–­æ¡†æ¶ Resilience4jï¼š"),n("a",S,[s("https://xie.infoq.cn/article/14786e571c1a4143ad1ef8f19"),e(a)])]),n("li",null,[s("è¶…è¯¦ç»†çš„ Guava RateLimiter é™æµåŸç†è§£æï¼š"),n("a",B,[s("https://cloud.tencent.com/developer/article/1408819"),e(a)])]),n("li",null,[s("å®æˆ˜ Spring Cloud Gateway ä¹‹é™æµç¯‡ ğŸ‘ï¼š"),n("a",N,[s("https://www.aneasystone.com/archives/2020/08/spring-cloud-gateway-current-limiting.html"),e(a)])])])])}const H=p(l,[["render",I],["__file","limit-request.html.vue"]]);export{H as default};
